{"version":3,"sources":["../../../../../src/lib/app/appServer/middlewares/importMiddleware.js"],"names":["configure","schema","type","items","properties","behaviours","event","required","reactions","ajv","req","res","validate","body","status","json","error","errors","dataPath","message","import","then","end"],"mappings":";;;;;kBAyCwBA,S;;AAzCxB;;;;;;AAEA,IAAMC,SAAS;AACbC,QAAM,OADO;AAEbC,SAAO;AACLD,UAAM,QADD;AAELE,gBAAY;AACVC,kBAAY;AACVH,cAAM,OADI;AAEVC,eAAO;AACLD,gBAAM,QADD;AAELE,sBAAY;AACVE,mBAAO;AACLJ,oBAAM,QADD;AAELE,0BAAY;AACVF,sBAAM;AACJA,wBAAM;AADF;AADI,eAFP;AAOLK,wBAAU,CAAC,MAAD;AAPL,aADG;AAUVC,uBAAW;AACTN,oBAAM,OADG;AAETC,qBAAO;AACLD,sBAAM,QADD;AAELE,4BAAY;AACVF,wBAAM;AACJA,0BAAM;AADF;AADI,iBAFP;AAOLK,0BAAU,CAAC,MAAD;AAPL;AAFE;AAVD,WAFP;AAyBLA,oBAAU,CAAC,WAAD,EAAc,OAAd;AAzBL;AAFG;AADF;AAFP;AAFM,CAAf;;AAuCe,SAASP,SAAT,CAAmBS,GAAnB,EAAwB;AACrC,SAAO,UAACC,GAAD,EAAMC,GAAN,EAAc;AACnB,QAAI,CAACF,IAAIG,QAAJ,CAAaX,MAAb,EAAqBS,IAAIG,IAAzB,CAAL,EAAqC;AACnCF,UAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAUP,IAAIQ,MAAJ,CAAW,CAAX,EAAcC,QAAxB,SAAoCT,IAAIQ,MAAJ,CAAW,CAAX,EAAcE,OAApD,EAArB;AACA;AACD;;AAED,yBAAWC,MAAX,CAAkBV,IAAIG,IAAtB,EAA4BQ,IAA5B,CAAiC,YAAM;AACrCV,UAAIW,GAAJ;AACD,KAFD;AAGD,GATD;AAUD","file":"importMiddleware.js","sourcesContent":["import serversHub from '../../serversHub';\n\nconst schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      behaviours: {\n        type: 'array',\n        items: {\n          type: 'object',\n          properties: {\n            event: {\n              type: 'object',\n              properties: {\n                type: {\n                  type: 'string'\n                }\n              },\n              required: ['type']\n            },\n            reactions: {\n              type: 'array',\n              items: {\n                type: 'object',\n                properties: {\n                  type: {\n                    type: 'string'\n                  }\n                },\n                required: ['type']\n              }\n            }\n          },\n          required: ['reactions', 'event']\n        }\n      }\n    }\n  }\n};\n\nexport default function configure(ajv) {\n  return (req, res) => {\n    if (!ajv.validate(schema, req.body)) {\n      res.status(400).json({ error: `${ajv.errors[0].dataPath} ${ajv.errors[0].message}` });\n      return;\n    }\n\n    serversHub.import(req.body).then(() => {\n      res.end();\n    });\n  };\n}\n"]}