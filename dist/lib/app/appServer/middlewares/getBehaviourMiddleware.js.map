{"version":3,"sources":["../../../../../src/lib/app/appServer/middlewares/getBehaviourMiddleware.js"],"names":["configure","schema","properties","server","type","scenario","id","required","ajv","req","res","validate","query","status","json","errors","getServer","end","behaviour","webServer","codex","getBehaviour","error","message"],"mappings":";;;;;kBAkBwBA,S;;AAlBxB;;;;AACA;;;;AAEA,IAAMC,SAAS;AACbC,cAAY;AACVC,YAAQ;AACNC,YAAM;AADA,KADE;AAIVC,cAAU;AACRD,YAAM;AADE,KAJA;AAOVE,QAAI;AACFF,YAAM;AADJ;AAPM,GADC;AAYbG,YAAU,CAAC,QAAD,EAAW,UAAX,EAAuB,IAAvB;AAZG,CAAf;;AAee,SAASP,SAAT,CAAmBQ,GAAnB,EAAwB;AACrC,SAAO,UAACC,GAAD,EAAMC,GAAN,EAAc;AACnB,QAAI,CAACF,IAAIG,QAAJ,CAAaV,MAAb,EAAqBQ,IAAIG,KAAzB,CAAL,EAAsC;AACpCF,UAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,IAAIO,MAAzB;AACA;AACD;;AAED,QAAI;AACF,UAAMZ,SAAS,qBAAWa,SAAX,CAAqBP,IAAIG,KAAJ,CAAUT,MAA/B,CAAf;;AAEA,UAAI,CAACA,MAAL,EAAa;AACXO,YAAIG,MAAJ,CAAW,GAAX,EAAgBI,GAAhB;AACA;AACD;;AAED,UAAMC,YAAYf,OAAOgB,SAAP,CAAiBC,KAAjB,CAAuBC,YAAvB,CAAoCZ,IAAIG,KAAJ,CAAUN,EAA9C,CAAlB;AACA,UAAI,CAACY,SAAL,EAAgB;AACdR,YAAIG,MAAJ,CAAW,GAAX,EAAgBI,GAAhB;AACA;AACD;;AAEDP,UAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,uCAAoBI,SAApB,CAArB;AACD,KAfD,CAeE,OAAOI,KAAP,EAAc;AACdZ,UAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEQ,OAAOA,MAAMC,OAAf,EAArB;AACD;AACF,GAxBD;AAyBD","file":"getBehaviourMiddleware.js","sourcesContent":["import serversHub from '../../serversHub';\nimport { behaviourToResponse } from './transformers';\n\nconst schema = {\n  properties: {\n    server: {\n      type: 'string'\n    },\n    scenario: {\n      type: 'string'\n    },\n    id: {\n      type: 'string'\n    }\n  },\n  required: ['server', 'scenario', 'id']\n};\n\nexport default function configure(ajv) {\n  return (req, res) => {\n    if (!ajv.validate(schema, req.query)) {\n      res.status(400).json(ajv.errors);\n      return;\n    }\n\n    try {\n      const server = serversHub.getServer(req.query.server);\n\n      if (!server) {\n        res.status(404).end();\n        return;\n      }\n\n      const behaviour = server.webServer.codex.getBehaviour(req.query.id);\n      if (!behaviour) {\n        res.status(404).end();\n        return;\n      }\n\n      res.status(200).json(behaviourToResponse(behaviour));\n    } catch (error) {\n      res.status(500).json({ error: error.message });\n    }\n  };\n}\n"]}