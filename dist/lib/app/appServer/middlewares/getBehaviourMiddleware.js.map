{"version":3,"sources":["../../../../../src/lib/app/appServer/middlewares/getBehaviourMiddleware.js"],"names":["getBehaviourMiddleware","schema","properties","server","type","scenario","id","required","req","res","validate","query","status","json","errors","getServer","end","behaviour","webServer","codex","getBehaviour","error","message"],"mappings":";;;;;kBAmBwBA,sB;;AAnBxB;;;;AACA;;AACA;;;;;;AAEA,IAAMC,SAAS;AACbC,cAAY;AACVC,YAAQ;AACNC,YAAM;AADA,KADE;AAIVC,cAAU;AACRD,YAAM;AADE,KAJA;AAOVE,QAAI;AACFF,YAAM;AADJ;AAPM,GADC;AAYbG,YAAU,CAAC,QAAD,EAAW,UAAX,EAAuB,IAAvB;AAZG,CAAf;;AAee,SAASP,sBAAT,CAAgCQ,GAAhC,EAAqCC,GAArC,EAA0C;AACvD,MAAI,CAAC,cAAIC,QAAJ,CAAaT,MAAb,EAAqBO,IAAIG,KAAzB,CAAL,EAAsC;AACpCF,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,cAAIC,MAAzB;AACA;AACD;;AAED,MAAI;AACF,QAAMX,SAAS,qBAAWY,SAAX,CAAqBP,IAAIG,KAAJ,CAAUR,MAA/B,CAAf;;AAEA,QAAI,CAACA,MAAL,EAAa;AACXM,UAAIG,MAAJ,CAAW,GAAX,EAAgBI,GAAhB;AACA;AACD;;AAED,QAAMC,YAAYd,OAAOe,SAAP,CAAiBC,KAAjB,CAAuBC,YAAvB,CAAoCZ,IAAIG,KAAJ,CAAUL,EAA9C,CAAlB;AACA,QAAI,CAACW,SAAL,EAAgB;AACdR,UAAIG,MAAJ,CAAW,GAAX,EAAgBI,GAAhB;AACA;AACD;;AAEDP,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,uCAAoBI,SAApB,CAArB;AACD,GAfD,CAeE,OAAOI,KAAP,EAAc;AACdZ,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEQ,OAAOA,MAAMC,OAAf,EAArB;AACD;AACF","file":"getBehaviourMiddleware.js","sourcesContent":["import serversHub from '../../serversHub';\nimport { behaviourToResponse } from './transformers';\nimport ajv from '../ajv';\n\nconst schema = {\n  properties: {\n    server: {\n      type: 'string'\n    },\n    scenario: {\n      type: 'string'\n    },\n    id: {\n      type: 'string'\n    }\n  },\n  required: ['server', 'scenario', 'id']\n};\n\nexport default function getBehaviourMiddleware(req, res) {\n  if (!ajv.validate(schema, req.query)) {\n    res.status(400).json(ajv.errors);\n    return;\n  }\n\n  try {\n    const server = serversHub.getServer(req.query.server);\n\n    if (!server) {\n      res.status(404).end();\n      return;\n    }\n\n    const behaviour = server.webServer.codex.getBehaviour(req.query.id);\n    if (!behaviour) {\n      res.status(404).end();\n      return;\n    }\n\n    res.status(200).json(behaviourToResponse(behaviour));\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n}\n"]}