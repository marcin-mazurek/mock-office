{"version":3,"sources":["../../../../../src/lib/app/webServers/ws/WsServerCodex.js"],"names":["defaultEvent","type","defaultReaction","WsServerCodex","serverId","addBehaviour","bind","behaviourCfg","behaviour","cfg","event","reactions","map","r","Error","behaviours","push"],"mappings":";;;;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;AAEA,IAAMA,eAAe;AACnBC,QAAM;AADa,CAArB;;AAIA,IAAMC,kBAAkB;AACtBD,QAAM;AADgB,CAAxB;;IAIqBE,a;;;AACnB,yBAAYC,QAAZ,EAAsB;AAAA;;AAAA,8HACdA,QADc;;AAEpB,UAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBC,IAAlB,OAApB;AAFoB;AAGrB;;AAED;;;;;iCACaC,Y,EAAc;AACzB,UAAIC,kBAAJ;AACA,UAAMC,MAAM,2BAAe,EAAEC,OAAOV,YAAT,EAAf,EAAwCO,YAAxC,CAAZ;AACAE,UAAIE,SAAJ,GAAgBF,IAAIE,SAAJ,CAAcC,GAAd,CAAkB;AAAA,eAAK,2BAAeV,eAAf,EAAgCW,CAAhC,CAAL;AAAA,OAAlB,CAAhB;;AAEA,cAAQJ,IAAIC,KAAJ,CAAUT,IAAlB;AACE,aAAK,SAAL;AAAgB;AACdO,wBAAY,+BAAqB,KAAKJ,QAA1B,EAAoCK,GAApC,CAAZ;AACA;AACD;AACD,aAAK,YAAL;AAAmB;AACjBD,wBAAY,kCAAwB,KAAKJ,QAA7B,EAAuCK,GAAvC,CAAZ;AACA;AACD;AACD;AAAS;AACP,kBAAM,IAAIK,KAAJ,CAAU,8BAAV,CAAN;AACD;AAXH;;AAcA,WAAKC,UAAL,CAAgBC,IAAhB,CAAqBR,SAArB;AACA,aAAOA,SAAP;AACD;;;;;;kBA5BkBL,a","file":"WsServerCodex.js","sourcesContent":["import { mergeDeepRight } from 'ramda';\nimport MessageBehaviour from '../ws/MessageBehaviour';\nimport ConnectionBehaviour from '../ws/ConnectionBehaviour';\nimport Codex from '../../codex';\n\nconst defaultEvent = {\n  type: 'message'\n};\n\nconst defaultReaction = {\n  type: 'message'\n};\n\nexport default class WsServerCodex extends Codex {\n  constructor(serverId) {\n    super(serverId);\n    this.addBehaviour = this.addBehaviour.bind(this);\n  }\n\n  // addBehaviour :: Object -> Behaviour\n  addBehaviour(behaviourCfg) {\n    let behaviour;\n    const cfg = mergeDeepRight({ event: defaultEvent }, behaviourCfg);\n    cfg.reactions = cfg.reactions.map(r => mergeDeepRight(defaultReaction, r));\n\n    switch (cfg.event.type) {\n      case 'message': {\n        behaviour = new MessageBehaviour(this.serverId, cfg);\n        break;\n      }\n      case 'connection': {\n        behaviour = new ConnectionBehaviour(this.serverId, cfg);\n        break;\n      }\n      default: {\n        throw new Error('Invalid behaviour event type');\n      }\n    }\n\n    this.behaviours.push(behaviour);\n    return behaviour;\n  }\n}\n"]}